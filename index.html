<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Таймер кода</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background: url('background.png') no-repeat center center fixed;
            background-size: cover;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            position: relative;
        }

        .blur-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .activation-modal {
            background: rgba(0, 0, 0, 0.8);
            padding: 40px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid #fff;
            max-width: 500px;
            width: 90%;
        }

        .activation-modal h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .activation-modal p {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .activation-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
        }

        .activation-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .activation-button:hover {
            background: #45a049;
        }

        .container {
            background: rgba(0, 0, 0, 0.6);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .timer {
            font-size: 2.5em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .promo-code {
            font-size: 1.8em;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .discount {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #ffeb3b;
        }

        .label {
            font-size: 1.2em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .claim-button {
            background: #ff5722;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 10px;
        }

        .claim-button:hover {
            background: #e64a19;
        }

        .claim-button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .claimed-message {
            font-size: 1.5em;
            color: #ff4444;
            margin-top: 20px;
        }

        .success-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 15px;
            border: 2px solid #4CAF50;
            z-index: 2000;
            text-align: center;
        }

        .admin-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #2196F3;
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            z-index: 3000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .admin-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #2196F3;
            z-index: 4000;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .admin-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 8px;
        }

        .admin-section h3 {
            margin-top: 0;
            color: #2196F3;
        }

        .code-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        .generate-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }

        .duration-selector {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
            z-index: 3001;
        }

        .duration-option {
            display: block;
            background: #333;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }

        .duration-option:hover {
            background: #444;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body oncontextmenu="return false;">
    <!-- Блюр и активация -->
    <div id="blurOverlay" class="blur-overlay">
        <div class="activation-modal">
            <h2>Активация сайта</h2>
            <p>Для использования сайта необходим ключ активации. Если у вас его нет, вы можете приобрести его на моём FunPay:</p>
            <p><a href="https://funpay.com/users/8048046/" style="color: #4CAF50;">https://funpay.com/users/8048046/</a></p>
            <input type="text" id="activationKey" class="activation-input" placeholder="Введите ключ активации">
            <button onclick="activateSite()" class="activation-button">Активировать</button>
            <p id="activationMessage" style="color: #ff4444; margin-top: 10px;"></p>
        </div>
    </div>

    <!-- Основной контент -->
    <div id="mainContent" class="container hidden">
        <div class="label">До следующего кода:</div>
        <div class="timer" id="timer">00:00:00</div>
        
        <div class="label">Текущий промокод:</div>
        <div class="promo-code" id="promoCode">XXXX-XXXX-XXXX-XXXX</div>
        
        <div class="label">Скидка:</div>
        <div class="discount" id="discount">0%</div>
        
        <button id="claimButton" class="claim-button" onclick="claimPromoCode()">Забрать промокод</button>
        <div id="claimedMessage" class="claimed-message hidden">Промокод уже забрали :(</div>
    </div>

    <!-- Модальное окно успеха -->
    <div id="successModal" class="success-modal hidden">
        <h2>Поздравляю!</h2>
        <p>Ты смог забрать промокод.</p>
        <p class="promo-code" id="successPromoCode">XXXX-XXXX-XXXX-XXXX</p>
        <button onclick="closeSuccessModal()" class="activation-button">Закрыть</button>
    </div>

    <!-- Админ панель -->
    <button id="adminButton" class="admin-button hidden">⚙</button>
    
    <div id="durationSelector" class="duration-selector hidden">
        <button class="duration-option" onclick="setDuration(1)">1 день</button>
        <button class="duration-option" onclick="setDuration(7)">1 неделя</button>
        <button class="duration-option" onclick="setDuration(30)">1 месяц</button>
    </div>

    <div id="adminPanel" class="admin-panel hidden">
        <h2>Панель администратора</h2>
        
        <div class="admin-section">
            <h3>Сгенерировать промокод</h3>
            <button onclick="generateSingleCode()" class="generate-button">Сгенерировать код</button>
            <div id="currentCode" class="code-item">Текущий код: -</div>
        </div>

        <div class="admin-section">
            <h3>История кодов</h3>
            <div id="codeHistory"></div>
        </div>

        <div class="admin-section">
            <h3>Активированные коды</h3>
            <div id="activatedCodes"></div>
        </div>

        <div class="admin-section">
            <h3>Неактивированные коды</h3>
            <div id="inactiveCodes"></div>
        </div>

        <button onclick="closeAdminPanel()" class="claim-button" style="background: #666;">Закрыть</button>
    </div>

    <script>
        // Конфигурация
        const ADMIN_IP = '171.33.254.90';
        let currentDuration = 1; // дни
        let userIP = '';

        // Получаем IP пользователя
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userIP = data.ip;
                checkAdminAccess();
            } catch (error) {
                console.log('Не удалось получить IP');
                checkAdminAccess();
            }
        }

        function checkAdminAccess() {
            if (userIP === ADMIN_IP) {
                // Для админа сразу показываем контент
                document.getElementById('blurOverlay').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                document.getElementById('adminButton').classList.remove('hidden');
                loadAdminData();
            }
        }

        // Активация сайта
        function activateSite() {
            const key = document.getElementById('activationKey').value.trim();
            const messageElement = document.getElementById('activationMessage');
            
            // Проверяем ключ (здесь должна быть ваша логика проверки)
            if (validateActivationKey(key)) {
                document.getElementById('blurOverlay').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                localStorage.setItem('site_activated', 'true');
                localStorage.setItem('activation_key', key);
                updateTimerAndPromo();
            } else {
                messageElement.textContent = 'Неверный ключ активации!';
            }
        }

        function validateActivationKey(key) {
            // Здесь должна быть ваша логика проверки ключей
            // Для примера, принимаем любой ключ длиной более 10 символов
            return key.length >= 10;
        }

        // Проверяем активацию при загрузке
        function checkActivation() {
            if (localStorage.getItem('site_activated') === 'true') {
                document.getElementById('blurOverlay').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                updateTimerAndPromo();
            }
        }

        // Генерация скидки
        function generateDiscount() {
            const random = Math.random() * 100;
            if (random < 70) return '5%';
            if (random < 95) return '10%';
            return '15%';
        }

        // Админ функции
        function setDuration(days) {
            currentDuration = days;
            document.getElementById('durationSelector').classList.add('hidden');
        }

        function generateSingleCode() {
            const code = generatePromoCode();
            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + currentDuration);
            
            const codeData = {
                code: code,
                generated: new Date().toLocaleString(),
                expires: expiryDate.toLocaleDateString(),
                activated: false,
                duration: currentDuration + ' дней'
            };
            
            // Сохраняем в историю
            let history = JSON.parse(localStorage.getItem('codeHistory') || '[]');
            history.unshift(codeData);
            localStorage.setItem('codeHistory', JSON.stringify(history));
            
            // Сохраняем в неактивированные
            let inactive = JSON.parse(localStorage.getItem('inactiveCodes') || '[]');
            inactive.unshift(codeData);
            localStorage.setItem('inactiveCodes', JSON.stringify(inactive));
            
            document.getElementById('currentCode').textContent = `Текущий код: ${code}`;
            loadAdminData();
        }

        function loadAdminData() {
            // Загружаем историю
            const history = JSON.parse(localStorage.getItem('codeHistory') || '[]');
            const historyElement = document.getElementById('codeHistory');
            historyElement.innerHTML = history.map(item => 
                `<div class="code-item">${item.code} (${item.generated}) - ${item.duration}</div>`
            ).join('');
            
            // Загружаем активированные коды
            const activated = JSON.parse(localStorage.getItem('activatedCodes') || '[]');
            const activatedElement = document.getElementById('activatedCodes');
            activatedElement.innerHTML = activated.map(item => 
                `<div class="code-item">${item.code} - до ${item.expires}</div>`
            ).join('');
            
            // Загружаем неактивированные коды
            const inactive = JSON.parse(localStorage.getItem('inactiveCodes') || '[]');
            const inactiveElement = document.getElementById('inactiveCodes');
            inactiveElement.innerHTML = inactive.map(item => 
                `<div class="code-item">${item.code} - до ${item.expires}</div>`
            ).join('');
        }

        // UI функции
        function toggleAdminPanel() {
            const panel = document.getElementById('adminPanel');
            panel.classList.toggle('hidden');
        }

        function toggleDurationSelector() {
            const selector = document.getElementById('durationSelector');
            selector.classList.toggle('hidden');
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.add('hidden');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
        }

        // Забрать промокод
        function claimPromoCode() {
            const promoCode = document.getElementById('promoCode').textContent;
            const discount = document.getElementById('discount').textContent;
            
            document.getElementById('successPromoCode').textContent = promoCode;
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('claimButton').disabled = true;
            
            // Помечаем промокод как забранный
            localStorage.setItem('promo_claimed', 'true');
            document.getElementById('claimedMessage').classList.remove('hidden');
        }

        // Проверяем забран ли промокод
        function checkClaimed() {
            if (localStorage.getItem('promo_claimed') === 'true') {
                document.getElementById('claimButton').disabled = true;
                document.getElementById('claimedMessage').classList.remove('hidden');
            }
        }

        // Оригинальные функции таймера и промокодов
        function generatePromoCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 16; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
                if ((i + 1) % 4 === 0 && i !== 15) {
                    result += '-';
                }
            }
            return result;
        }

        function getNextUpdateTime() {
            const now = new Date();
            const mskOffset = 3 * 60;
            const nowMsk = new Date(now.getTime() + (mskOffset - now.getTimezoneOffset()) * 60000);
            
            const periodsPerDay = 4;
            const periodMinutes = 6 * 60;
            
            const totalMinutesToday = nowMsk.getHours() * 60 + nowMsk.getMinutes();
            const currentPeriod = Math.floor(totalMinutesToday / periodMinutes);
            const nextPeriod = (currentPeriod + 1) % periodsPerDay;
            
            let nextUpdate = new Date(nowMsk);
            nextUpdate.setHours(Math.floor(nextPeriod * 6), 0, 0, 0);
            
            if (nextUpdate <= nowMsk) {
                nextUpdate.setDate(nextUpdate.getDate() + 1);
            }
            
            return new Date(nextUpdate.getTime() - (mskOffset - now.getTimezoneOffset()) * 60000);
        }

        function updateTimerAndPromo() {
            const now = new Date();
            const nextUpdate = getNextUpdateTime();
            const timeLeft = nextUpdate - now;

            if (timeLeft <= 0) {
                updatePromoCode();
                return;
            }

            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

            document.getElementById('timer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            const currentPeriod = getCurrentPeriod();
            let storedPromo = localStorage.getItem('promoCode_' + currentPeriod);
            
            if (!storedPromo) {
                storedPromo = generatePromoCode();
                localStorage.setItem('promoCode_' + currentPeriod, storedPromo);
                localStorage.setItem('promoCode_timestamp', currentPeriod);
                
                // Генерируем скидку
                const discount = generateDiscount();
                localStorage.setItem('discount_' + currentPeriod, discount);
            }

            const discount = localStorage.getItem('discount_' + currentPeriod) || '5%';
            
            document.getElementById('promoCode').textContent = storedPromo;
            document.getElementById('discount').textContent = discount;
        }

        function getCurrentPeriod() {
            const now = new Date();
            const mskOffset = 3 * 60;
            const nowMsk = new Date(now.getTime() + (mskOffset - now.getTimezoneOffset()) * 60000);
            
            const periodsPerDay = 4;
            const periodMinutes = 6 * 60;
            const totalMinutesToday = nowMsk.getHours() * 60 + nowMsk.getMinutes();
            
            return Math.floor(totalMinutesToday / periodMinutes);
        }

        function updatePromoCode() {
            const currentPeriod = getCurrentPeriod();
            const newPromoCode = generatePromoCode();
            const discount = generateDiscount();
            
            localStorage.setItem('promoCode_' + currentPeriod, newPromoCode);
            localStorage.setItem('promoCode_timestamp', currentPeriod);
            localStorage.setItem('discount_' + currentPeriod, discount);
            
            document.getElementById('promoCode').textContent = newPromoCode;
            document.getElementById('discount').textContent = discount;
        }

        // Защита от инструментов разработчика
        document.addEventListener('keydown', function(e) {
            if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && e.keyCode === 73) || 
                (e.ctrlKey && e.shiftKey && e.keyCode === 74) || (e.ctrlKey && e.keyCode === 85) || 
                (e.ctrlKey && e.keyCode === 83)) {
                e.preventDefault();
                return false;
            }
        });

        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });

        setInterval(function() {
            if (window.outerHeight - window.innerHeight > 200 || 
                window.outerWidth - window.innerWidth > 200) {
                window.close();
                window.location.href = 'about:blank';
            }
        }, 1000);

        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
            return false;
        });

        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            getUserIP();
            checkActivation();
            checkClaimed();
            
            if (localStorage.getItem('site_activated') === 'true' || userIP === ADMIN_IP) {
                updateTimerAndPromo();
                setInterval(updateTimerAndPromo, 1000);
            }
        });
    </script>
</body>
</html>