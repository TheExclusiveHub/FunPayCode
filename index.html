<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Таймер кода</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background: url('background.png') no-repeat center center fixed;
            background-size: cover;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            position: relative;
            overflow: hidden;
        }

        .blur-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .activation-modal {
            background: rgba(0, 0, 0, 0.8);
            padding: 40px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid #fff;
            max-width: 500px;
            width: 90%;
        }

        .activation-modal h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .activation-modal p {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .activation-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
        }

        .activation-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .activation-button:hover {
            background: #45a049;
        }

        .container {
            background: rgba(0, 0, 0, 0.6);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .timer {
            font-size: 2.5em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .promo-code {
            font-size: 1.8em;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .discount {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #ffeb3b;
        }

        .label {
            font-size: 1.2em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .claim-button {
            background: #ff5722;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 10px;
        }

        .claim-button:hover {
            background: #e64a19;
        }

        .claim-button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .claimed-message {
            font-size: 1.5em;
            color: #ff4444;
            margin-top: 20px;
        }

        .success-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 15px;
            border: 2px solid #4CAF50;
            z-index: 2000;
            text-align: center;
        }

        .admin-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #2196F3;
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            z-index: 3000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.3s;
        }

        .admin-button:hover {
            transform: scale(1.1);
        }

        .admin-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #2196F3;
            z-index: 4000;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .brainrot-history-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #FF5722;
            z-index: 4000;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .admin-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 8px;
        }

        .admin-section h3 {
            margin-top: 0;
            color: #2196F3;
        }

        .code-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        .generate-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }

        .duration-selector {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
            z-index: 3001;
        }

        .duration-option {
            display: block;
            background: #333;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }

        .duration-option:hover {
            background: #444;
        }

        .hidden {
            display: none;
        }

        /* Онлайн и подписка */
        .online-counter {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.1em;
        }

        .subscription-info {
            position: fixed;
            bottom: 20px;
            right: 90px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.1em;
        }

        /* Brainrot изображения */
        .brainrot-image {
            position: absolute;
            width: 100px;
            height: 100px;
            cursor: pointer;
            transition: all 0.5s ease-in-out;
            z-index: 100;
        }

        .brainrot-image.fade-out {
            opacity: 0;
            transform: scale(0.1) rotate(360deg);
        }

        /* Brainrot модальное окно */
        .brainrot-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 15px;
            border: 2px solid #FF5722;
            z-index: 2000;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .brainrot-modal img {
            max-width: 200px;
            max-height: 200px;
            margin: 20px 0;
        }

        .brainrot-code {
            font-size: 1.5em;
            font-family: 'Courier New', monospace;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 15px 0;
            letter-spacing: 2px;
        }

        .history-item {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }

        .history-item img {
            width: 50px;
            height: 50px;
            margin-right: 15px;
        }

        .history-info {
            text-align: left;
        }

        .history-name {
            font-weight: bold;
            color: #ffeb3b;
        }

        .history-code {
            font-family: 'Courier New', monospace;
            color: #4CAF50;
        }
    </style>
</head>
<body oncontextmenu="return false;">
    <!-- Блюр и активация -->
    <div id="blurOverlay" class="blur-overlay">
        <div class="activation-modal">
            <h2>Активация сайта</h2>
            <p>Для использования сайта необходим ключ активации. Если у вас его нет, вы можете приобрести его на моём FunPay:</p>
            <p><a href="https://funpay.com/users/8048046/" style="color: #4CAF50;">https://funpay.com/users/8048046/</a></p>
            <input type="text" id="activationKey" class="activation-input" placeholder="Введите ключ активации">
            <button onclick="activateSite()" class="activation-button">Активировать</button>
            <p id="activationMessage" style="color: #ff4444; margin-top: 10px;"></p>
        </div>
    </div>

    <!-- Основной контент -->
    <div id="mainContent" class="container hidden">
        <div class="label">До следующего кода:</div>
        <div class="timer" id="timer">00:00:00</div>
        
        <div class="label">Текущий промокод:</div>
        <div class="promo-code" id="promoCode">XXXX-XXXX-XXXX-XXXX</div>
        
        <div class="label">Скидка:</div>
        <div class="discount" id="discount">0%</div>
        
        <button id="claimButton" class="claim-button" onclick="claimPromoCode()">Забрать промокод</button>
        <div id="claimedMessage" class="claimed-message hidden">Промокод уже забрали :(</div>
    </div>

    <!-- Онлайн и подписка -->
    <div class="online-counter" id="onlineCounter">Онлайн: 1</div>
    <div class="subscription-info" id="subscriptionInfo">Подписка действует до: --.--.----</div>

    <!-- Модальное окно успеха -->
    <div id="successModal" class="success-modal hidden">
        <h2>Поздравляю!</h2>
        <p>Ты смог забрать промокод.</p>
        <p class="promo-code" id="successPromoCode">XXXX-XXXX-XXXX-XXXX</p>
        <button onclick="closeSuccessModal()" class="activation-button">Закрыть</button>
    </div>

    <!-- Brainrot модальное окно -->
    <div id="brainrotModal" class="brainrot-modal hidden">
        <h2>Поздравляю! Ты нашёл брейнрота!</h2>
        <p>Для получения приза напиши продавцу:</p>
        <div class="brainrot-code" id="brainrotCode">XXX-XXX</div>
        <img id="foundBrainrotImage" src="" alt="Brainrot">
        <button onclick="claimBrainrotPrize()" class="claim-button">Забрать приз</button>
    </div>

    <!-- Админ панель -->
    <button id="adminButton" class="admin-button hidden" onclick="toggleAdminPanel()">⚙</button>
    
    <div id="durationSelector" class="duration-selector hidden">
        <button class="duration-option" onclick="setDuration(1)">1 день</button>
        <button class="duration-option" onclick="setDuration(7)">1 неделя</button>
        <button class="duration-option" onclick="setDuration(30)">1 месяц</button>
    </div>

    <div id="adminPanel" class="admin-panel hidden">
        <h2>Панель администратора</h2>
        
        <div class="admin-section">
            <h3>Длительность промокода</h3>
            <button onclick="toggleDurationSelector()" class="generate-button">Выбрать длительность</button>
            <div>Текущая: <span id="currentDuration">1 день</span></div>
        </div>

        <div class="admin-section">
            <h3>Сгенерировать промокод</h3>
            <button onclick="generateSingleCode()" class="generate-button">Сгенерировать код</button>
            <div id="currentCode" class="code-item">Текущий код: -</div>
        </div>

        <div class="admin-section">
            <h3>История кодов</h3>
            <div id="codeHistory">Нет данных</div>
        </div>

        <div class="admin-section">
            <h3>Активированные коды</h3>
            <div id="activatedCodes">Нет данных</div>
        </div>

        <div class="admin-section">
            <h3>Неактивированные коды</h3>
            <div id="inactiveCodes">Нет данных</div>
        </div>

        <button onclick="closeAdminPanel()" class="claim-button" style="background: #666; margin-top: 20px;">Закрыть</button>
        <button onclick="showBrainrotHistory()" class="claim-button" style="background: #FF5722; margin-top: 10px;">История брейнротов</button>
    </div>

    <!-- Панель истории брейнротов -->
    <div id="brainrotHistoryPanel" class="brainrot-history-panel hidden">
        <h2>История нахождения брейнротов</h2>
        <div id="brainrotHistoryList">Нет данных</div>
        <button onclick="closeBrainrotHistory()" class="claim-button" style="background: #666; margin-top: 20px;">Закрыть</button>
    </div>

    <script>
        // Конфигурация
        const ADMIN_IP = '171.33.254.90';
        let currentDuration = 1; // дни
        let userIP = '';
        let isAdmin = false;
        let timerInterval = null;
        let brainrotInterval = null;
        let onlineUsers = 1;
        const brainrotImages = [
            'CrazylonePizaion.png',
            'Los_Tralaleritos.png', 
            'LosSeko.png',
            'Meowzio_Sushini.png'
        ];

        // Получаем IP пользователя
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userIP = data.ip;
                console.log('User IP:', userIP);
                checkAdminAccess();
            } catch (error) {
                console.log('Не удалось получить IP');
                userIP = 'unknown';
                checkAdminAccess();
            }
        }

        function checkAdminAccess() {
            if (userIP === ADMIN_IP) {
                isAdmin = true;
                console.log('Admin access granted');
                // Для админа сразу показываем контент
                document.getElementById('blurOverlay').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                document.getElementById('adminButton').classList.remove('hidden');
                loadAdminData();
                startTimer();
                initializePromoCode();
                updateSubscriptionInfo();
            } else {
                console.log('Regular user');
            }
        }

        // Активация сайта
        function activateSite() {
            const key = document.getElementById('activationKey').value.trim();
            const messageElement = document.getElementById('activationMessage');
            
            // Проверяем, не активирован ли уже сайт
            if (localStorage.getItem('site_activated') === 'true') {
                messageElement.textContent = 'Сайт уже активирован!';
                return;
            }
            
            // Проверяем ключ
            if (validateActivationKey(key)) {
                document.getElementById('blurOverlay').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                localStorage.setItem('site_activated', 'true');
                localStorage.setItem('activation_key', key);
                
                // Устанавливаем дату окончания подписки (30 дней от текущей даты)
                const expiryDate = new Date();
                expiryDate.setDate(expiryDate.getDate() + 30);
                localStorage.setItem('subscription_expiry', expiryDate.getTime().toString());
                
                startTimer();
                initializePromoCode();
                updateSubscriptionInfo();
                startBrainrotSpawning();
            } else {
                messageElement.textContent = 'Неверный ключ активации!';
            }
        }

        function validateActivationKey(key) {
            return key.length >= 10;
        }

        // Проверяем активацию при загрузке
        function checkActivation() {
            if (localStorage.getItem('site_activated') === 'true') {
                document.getElementById('blurOverlay').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                startTimer();
                initializePromoCode();
                updateSubscriptionInfo();
                startBrainrotSpawning();
            }
        }

        // Обновление информации о подписке
        function updateSubscriptionInfo() {
            const expiryTimestamp = localStorage.getItem('subscription_expiry');
            if (expiryTimestamp) {
                const expiryDate = new Date(parseInt(expiryTimestamp));
                const day = expiryDate.getDate().toString().padStart(2, '0');
                const month = (expiryDate.getMonth() + 1).toString().padStart(2, '0');
                const year = expiryDate.getFullYear();
                const hours = expiryDate.getHours().toString().padStart(2, '0');
                const minutes = expiryDate.getMinutes().toString().padStart(2, '0');
                
                document.getElementById('subscriptionInfo').textContent = 
                    `Подписка действует до: ${day}.${month}.${year} ${hours}:${minutes}`;
            }
        }

        // Онлайн пользователи
        function updateOnlineCounter() {
            // Простая имитация онлайн (можно заменить на реальную логику)
            onlineUsers = Math.max(1, Math.floor(Math.random() * 10) + 1);
            document.getElementById('onlineCounter').textContent = `Онлайн: ${onlineUsers}`;
        }

        // Brainrot система
        function startBrainrotSpawning() {
            // Спавним brainrot каждую минуту
            brainrotInterval = setInterval(spawnBrainrot, 60000);
            // Сразу спавним первый brainrot
            setTimeout(spawnBrainrot, 5000);
        }

        function spawnBrainrot() {
            const randomImage = brainrotImages[Math.floor(Math.random() * brainrotImages.length)];
            const img = document.createElement('img');
            img.src = randomImage;
            img.className = 'brainrot-image';
            img.alt = randomImage.replace('.png', '');
            
            // Случайная позиция на экране
            const maxX = window.innerWidth - 100;
            const maxY = window.innerHeight - 100;
            const posX = Math.floor(Math.random() * maxX);
            const posY = Math.floor(Math.random() * maxY);
            
            img.style.left = posX + 'px';
            img.style.top = posY + 'px';
            
            img.onclick = function() {
                const brainrotCode = generateBrainrotCode();
                showBrainrotModal(randomImage, brainrotCode);
                // Плавное исчезновение
                img.classList.add('fade-out');
                setTimeout(() => {
                    if (img.parentNode) {
                        img.parentNode.removeChild(img);
                    }
                }, 500);
                
                // Сохраняем в историю для админа
                if (isAdmin) {
                    saveBrainrotToHistory(randomImage, brainrotCode);
                }
            };
            
            document.body.appendChild(img);
            
            // Автоматически удаляем через 55 секунд если не нажали
            setTimeout(() => {
                if (img.parentNode && !img.classList.contains('fade-out')) {
                    img.classList.add('fade-out');
                    setTimeout(() => {
                        if (img.parentNode) {
                            img.parentNode.removeChild(img);
                        }
                    }, 500);
                }
            }, 55000);
        }

        function generateBrainrotCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
                if (i === 2) result += '-';
            }
            return result;
        }

        function showBrainrotModal(imageSrc, code) {
            document.getElementById('foundBrainrotImage').src = imageSrc;
            document.getElementById('brainrotCode').textContent = code;
            document.getElementById('brainrotModal').classList.remove('hidden');
        }

        function claimBrainrotPrize() {
            alert('Код отправлен продавцу! Ожидайте выдачи приза.');
            document.getElementById('brainrotModal').classList.add('hidden');
        }

        function saveBrainrotToHistory(imageSrc, code) {
            const brainrotName = imageSrc.replace('.png', '');
            const historyItem = {
                image: imageSrc,
                name: brainrotName,
                code: code,
                foundAt: new Date().toLocaleString('ru-RU')
            };
            
            let history = JSON.parse(localStorage.getItem('admin_brainrotHistory') || '[]');
            history.unshift(historyItem);
            localStorage.setItem('admin_brainrotHistory', JSON.stringify(history));
        }

        function showBrainrotHistory() {
            const history = JSON.parse(localStorage.getItem('admin_brainrotHistory') || '[]');
            const historyElement = document.getElementById('brainrotHistoryList');
            
            if (history.length > 0) {
                historyElement.innerHTML = history.map(item => `
                    <div class="history-item">
                        <img src="${item.image}" alt="${item.name}">
                        <div class="history-info">
                            <div class="history-name">${item.name}</div>
                            <div class="history-code">Код: ${item.code}</div>
                            <div>Найден: ${item.foundAt}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                historyElement.innerHTML = 'Нет данных';
            }
            
            document.getElementById('brainrotHistoryPanel').classList.remove('hidden');
        }

        function closeBrainrotHistory() {
            document.getElementById('brainrotHistoryPanel').classList.add('hidden');
        }

        // Остальные функции (генерация скидки, таймер, промокоды, админ-панель) остаются без изменений
        // ... (вставьте сюда все предыдущие функции из предыдущего кода)

        // Генерация скидки (одинаковая для всех)
        function generateGlobalDiscount() {
            const currentPeriod = getCurrentPeriod();
            let globalDiscount = localStorage.getItem('global_discount_' + currentPeriod);
            
            if (!globalDiscount) {
                const random = Math.random() * 100;
                if (random < 70) globalDiscount = '5%';
                else if (random < 95) globalDiscount = '10%';
                else globalDiscount = '15%';
                
                localStorage.setItem('global_discount_' + currentPeriod, globalDiscount);
            }
            
            return globalDiscount;
        }

        // Таймер и промокоды
        function generatePromoCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 16; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
                if ((i + 1) % 4 === 0 && i !== 15) {
                    result += '-';
                }
            }
            return result;
        }

        function getNextUpdateTime() {
            const now = new Date();
            const periodsPerDay = 4;
            const periodMinutes = 6 * 60;
            
            const totalMinutesToday = now.getHours() * 60 + now.getMinutes();
            const currentPeriod = Math.floor(totalMinutesToday / periodMinutes);
            const nextPeriod = (currentPeriod + 1) % periodsPerDay;
            
            let nextUpdate = new Date(now);
            nextUpdate.setHours(Math.floor(nextPeriod * 6), 0, 0, 0);
            
            if (nextUpdate <= now) {
                nextUpdate.setDate(nextUpdate.getDate() + 1);
            }
            
            return nextUpdate;
        }

        function updateTimerAndPromo() {
            const now = new Date();
            const nextUpdate = getNextUpdateTime();
            const timeLeft = nextUpdate - now;

            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

            document.getElementById('timer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            if (timeLeft <= 1000) {
                generateNewPromoCode();
            }
        }

        function initializePromoCode() {
            const currentPeriod = getCurrentPeriod();
            let storedPromo = localStorage.getItem('promoCode_' + currentPeriod);
            
            if (!storedPromo) {
                generateNewPromoCode();
            } else {
                const globalDiscount = generateGlobalDiscount();
                document.getElementById('promoCode').textContent = storedPromo;
                document.getElementById('discount').textContent = globalDiscount;
            }
            
            checkGlobalClaimed();
        }

        function generateNewPromoCode() {
            const currentPeriod = getCurrentPeriod();
            const newPromoCode = generatePromoCode();
            const globalDiscount = generateGlobalDiscount();
            
            localStorage.setItem('promoCode_' + currentPeriod, newPromoCode);
            localStorage.setItem('promoCode_timestamp', Date.now());
            
            document.getElementById('promoCode').textContent = newPromoCode;
            document.getElementById('discount').textContent = globalDiscount;
            
            localStorage.removeItem('global_promo_claimed_' + currentPeriod);
            checkGlobalClaimed();
        }

        function getCurrentPeriod() {
            const now = new Date();
            const periodsPerDay = 4;
            const periodMinutes = 6 * 60;
            const totalMinutesToday = now.getHours() * 60 + now.getMinutes();
            
            return Math.floor(totalMinutesToday / periodMinutes);
        }

        function startTimer() {
            updateTimerAndPromo();
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            timerInterval = setInterval(updateTimerAndPromo, 1000);
        }

        function checkGlobalClaimed() {
            const currentPeriod = getCurrentPeriod();
            const isClaimed = localStorage.getItem('global_promo_claimed_' + currentPeriod) === 'true';
            
            if (isClaimed) {
                document.getElementById('claimButton').disabled = true;
                document.getElementById('claimedMessage').classList.remove('hidden');
            } else {
                document.getElementById('claimButton').disabled = false;
                document.getElementById('claimedMessage').classList.add('hidden');
            }
        }

        // Админ функции
        function setDuration(days) {
            currentDuration = days;
            const durationText = days === 1 ? '1 день' : days === 7 ? '1 неделя' : '1 месяц';
            document.getElementById('currentDuration').textContent = durationText;
            document.getElementById('durationSelector').classList.add('hidden');
            
            if (isAdmin) {
                localStorage.setItem('admin_duration', days.toString());
            }
        }

        function generateSingleCode() {
            const code = generatePromoCode();
            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + currentDuration);
            
            const codeData = {
                code: code,
                generated: new Date().toLocaleString('ru-RU'),
                expires: expiryDate.toLocaleDateString('ru-RU'),
                activated: false,
                duration: currentDuration + ' дней'
            };
            
            let history = JSON.parse(localStorage.getItem('admin_codeHistory') || '[]');
            history.unshift(codeData);
            localStorage.setItem('admin_codeHistory', JSON.stringify(history));
            
            let inactive = JSON.parse(localStorage.getItem('admin_inactiveCodes') || '[]');
            inactive.unshift(codeData);
            localStorage.setItem('admin_inactiveCodes', JSON.stringify(inactive));
            
            document.getElementById('currentCode').textContent = `Текущий код: ${code}`;
            loadAdminData();
        }

        function loadAdminData() {
            if (!isAdmin) return;
            
            const savedDuration = localStorage.getItem('admin_duration');
            if (savedDuration) {
                currentDuration = parseInt(savedDuration);
                const durationText = currentDuration === 1 ? '1 день' : currentDuration === 7 ? '1 неделя' : '1 месяц';
                document.getElementById('currentDuration').textContent = durationText;
            }
            
            const history = JSON.parse(localStorage.getItem('admin_codeHistory') || '[]');
            const historyElement = document.getElementById('codeHistory');
            historyElement.innerHTML = history.length > 0 ? 
                history.map(item => 
                    `<div class="code-item">${item.code} (${item.generated}) - ${item.duration}</div>`
                ).join('') : 'Нет данных';
            
            const activated = JSON.parse(localStorage.getItem('admin_activatedCodes') || '[]');
            const activatedElement = document.getElementById('activatedCodes');
            activatedElement.innerHTML = activated.length > 0 ? 
                activated.map(item => 
                    `<div class="code-item">${item.code} - до ${item.expires}</div>`
                ).join('') : 'Нет данных';
            
            const inactive = JSON.parse(localStorage.getItem('admin_inactiveCodes') || '[]');
            const inactiveElement = document.getElementById('inactiveCodes');
            inactiveElement.innerHTML = inactive.length > 0 ? 
                inactive.map(item => 
                    `<div class="code-item">${item.code} - до ${item.expires}</div>`
                ).join('') : 'Нет данных';
        }

        // UI функции
        function toggleAdminPanel() {
            const panel = document.getElementById('adminPanel');
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                loadAdminData();
            } else {
                panel.classList.add('hidden');
            }
        }

        function toggleDurationSelector() {
            const selector = document.getElementById('durationSelector');
            selector.classList.toggle('hidden');
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('durationSelector').classList.add('hidden');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
        }

        function claimPromoCode() {
            const promoCode = document.getElementById('promoCode').textContent;
            
            document.getElementById('successPromoCode').textContent = promoCode;
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('claimButton').disabled = true;
            
            const currentPeriod = getCurrentPeriod();
            localStorage.setItem('global_promo_claimed_' + currentPeriod, 'true');
            document.getElementById('claimedMessage').classList.remove('hidden');
        }

        // Защита от инструментов разработчика
        document.addEventListener('keydown', function(e) {
            if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && e.keyCode === 73) || 
                (e.ctrlKey && e.shiftKey && e.keyCode === 74) || (e.ctrlKey && e.keyCode === 85) || 
                (e.ctrlKey && e.keyCode === 83)) {
                e.preventDefault();
                return false;
            }
        });

        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            getUserIP();
            checkActivation();
            checkGlobalClaimed();
            updateOnlineCounter();
            setInterval(updateOnlineCounter, 30000); // Обновляем онлайн каждые 30 секунд
        });
    </script>
</body>
</html>